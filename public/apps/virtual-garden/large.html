


<!DOCTYPE html>
<html>
  <head>
    <title>Virtual Garden</title>
    <script src="jquery-1.7.2.min.js"></script> 
    <script type="text/javascript">

	var data;
	$(document).ready(function() {			
		setTimeout(function() {
			getData();
		}, 500); //We need to wait for processing.js to download
		setInterval(function() {
			getData();
		}, 600000);						
	});


 	function resizeLots() {
		$("#lots").css({"width": $(window).width()})
		$("#lots").css({"height": $(window).height()})
	}


	function getURLParameter(name) {
	    return decodeURI(
		(RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
	    );
	}

        function getData() {
		var id = getURLParameter("displayId");
		$.getJSON("/api/"+id+"/analytics", function(data) {
        	        drawPlants(data);
		});

		/*Development*/
		/*
		data = jQuery.parseJSON( '[{"user":{"id":1,"name":"Roberto Calderon"},"data":{"messages_sent":24,"checkins":2},"links":[{"user_id":2,"messages_sent":22,"messages_received":2,"reciprocity_ratio":11}]},{"user":{"id":2,"name":"John Black"},"data":{"messages_sent":2,"checkins":1},"links":[{"user_id":1,"messages_sent":2,"messages_received":22,"reciprocity_ratio":0}]},{"user":{"id":3,"name":"Dawood Mslw"},"data":{"messages_sent":0,"checkins":0},"links":[]},{"user":{"id":4,"name":"Four Name"},"data":{"messages_sent":0,"checkins":10},"links":[]},{"user":{"id":5,"name":"Five Mslw"},"data":{"messages_sent":0,"checkins":100},"links":[]}]' );
		console.log(data)
                drawPlants(data);
		*/
	}

        function drawPlants(d) { //load object to procesing 
		$('#lots').empty();
		var sqr = Math.sqrt(d.length);
		var rows = Math.floor(sqr);
		var columns = Math.ceil(d.length/rows);
		$.each( d, function(index,value){
  			var imageNumber = Math.ceil(value.data.checkins/4);
			if (imageNumber < 1)
				imageNumber = 1;
			else if (imageNumber > 6)
				imageNumber = 6;
			$('#lots').append("<div class='lot' style='width:"+90/columns+"%; height:"+90/rows+"%; background:url(img/"+imageNumber+".jpg);background-repeat:no-repeat;background-size: contain;'><span class='checkins'>"+value.data.checkins+"</span><span class='name'>"+value.user.name+"</span></div>");
		});

		$('#lots div').each(function(){
		  var divWidth = $(this).width();
		  var divHeight = $(this).height();
 		  var newFontSize = Math.min(divWidth, divHeight);
		  var checkinsSize = newFontSize/3;
		  var nameSize = newFontSize/12;
   	   	  $(".checkins").css({"font-size" : checkinsSize});
   	   	  $(".name").css({"font-size" : nameSize});
   	   	  $(this).css({"background" : ":url(img/01.jpg)"});
		});

	}




    </script>
    <style>
	#lots{width:100%; height:100%; background:white; text-align:center; color:white; position:fixed; left:5px;top:5px;}
  	div .lot{float:left; position:relative; -moz-border-radius: 15px; border-radius: 15px; border-style:solid; border-width:2px; border-color:green; margin: 2px 2px; font-family:"Verdana", sans-serif;}
	.checkins{font-size:20px;color:green;position:absolute; top:5%;right:5%;}
	.name{font-size:14px;color:gray;position:absolute;bottom:5%;left:5%;}
    </style>
  </head>
  <body>
	<div id="lots"></div>
  </body>
</html>
